<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador ATS - PDF Profissional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: #2c3e50;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #eef2f3;
        }

        /* --- Editor (Esquerda) --- */
        .editor-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            height: 90vh;
            overflow-y: auto;
            border-top: 5px solid #0d6efd;
        }

        /* --- Visualização na TELA (Apenas Preview) --- */
        .preview-container {
            display: flex;
            justify-content: center;
            background-color: #555;
            padding: 30px;
            min-height: 100vh;
        }

        #resume-preview {
            background: white;
            width: 210mm; 
            min-height: 297mm;
            padding: 15mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            color: #000;
            line-height: 1.5;
            box-sizing: border-box;
        }

        /* --- ESTILOS DO CURRÍCULO (Compartilhados com a impressão) --- */
        /* Esses estilos serão injetados na janela de impressão via JS */
        
        .resume-content-style {
            font-size: 12pt;
            color: #000;
            line-height: 1.5;
        }

        .resume-name { font-size: 26pt; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; text-align: center; line-height: 1.1; }
        .resume-target-role { font-size: 14pt; font-weight: 500; text-transform: uppercase; color: #444; margin-bottom: 15px; text-align: center; }
        .resume-contact-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 25px; border-bottom: 2px solid #000; padding-bottom: 15px; font-size: 11pt; }
        .contact-item i { margin-right: 5px; color: #333; }
        
        .resume-section-title { font-size: 14pt; font-weight: 800; text-transform: uppercase; border-bottom: 2px solid #000; margin-top: 25px; margin-bottom: 15px; padding-bottom: 4px; }
        
        .resume-item { margin-bottom: 18px; }
        .resume-item-title { font-size: 13pt; font-weight: 700; }
        .resume-item-subtitle { font-weight: 500; font-size: 12pt; color: #222; }
        .resume-date { float: right; font-weight: 600; font-size: 11pt; }
        .resume-text { font-size: 12pt; text-align: left; margin-top: 5px; white-space: pre-wrap; }

        .skills-wrapper { display: flex; flex-wrap: wrap; gap: 8px 15px; }
        .skill-tag { display: inline-block; font-weight: 700; font-size: 12pt; }
        .skill-level { font-style: italic; font-weight: 400; font-size: 11pt; color: #444; }

        /* --- TEMAS (CSS que será injetado) --- */
        /* Moderno */
        .theme-modern .header-wrapper {
            background-color: #0d47a1; color: white;
            margin: -15mm -15mm 20px -15mm; padding: 15mm 15mm 10px 15mm; text-align: left;
            -webkit-print-color-adjust: exact; print-color-adjust: exact;
        }
        .theme-modern .resume-name, .theme-modern .resume-target-role, .theme-modern .contact-item, .theme-modern i { color: white !important; }
        .theme-modern .resume-section-title { color: #0d47a1; border-bottom: 1px solid #ccc; letter-spacing: 1px; }
        .theme-modern .resume-date { color: #1976d2; }

        /* Executivo */
        .theme-executive { font-family: 'Merriweather', serif; }
        .theme-executive .resume-name { border-bottom: 1px solid #333; padding-bottom: 10px; text-align: left; }
        .theme-executive .resume-target-role { font-style: italic; text-align: left; }
        .theme-executive .resume-contact-container { justify-content: flex-start; border: none; }
        .theme-executive .resume-section-title { background: #eee; padding: 5px 10px; border-left: 5px solid #333; border-bottom: none; -webkit-print-color-adjust: exact; print-color-adjust: exact;}

        @media (max-width: 991px) {
            #resume-preview { width: 100%; padding: 15px; zoom: 0.5; }
            .theme-modern .header-wrapper { margin: -15px -15px 15px -15px; padding: 20px; }
            .editor-section { height: auto; }
            .preview-container { display: block; }
        }
    </style>
</head>
<body>

    <header class="bg-dark text-white p-3 mb-0 shadow sticky-top">
        <div class="container d-flex justify-content-between align-items-center flex-wrap gap-2">
            <h1 class="h5 m-0"><i class="fas fa-print me-2"></i>Gerador ATS Profissional</h1>
            
            <div class="d-flex align-items-center gap-2">
                <label class="small fw-bold">Modelo:</label>
                <select id="themeSelector" class="form-select form-select-sm" style="width: 150px;" onchange="changeTheme()">
                    <option value="theme-classic">Clássico</option>
                    <option value="theme-modern">Moderno</option>
                    <option value="theme-executive">Executivo</option>
                </select>
            </div>

            <div>
                <button onclick="clearData()" class="btn btn-outline-secondary btn-sm me-2">Limpar</button>
                <button onclick="loadExampleData()" class="btn btn-outline-light btn-sm me-2">Preencher Exemplo</button>
                <button onclick="printPDF()" class="btn btn-success fw-bold btn-sm">
                    <i class="fas fa-download me-2"></i>Salvar PDF
                </button>
            </div>
        </div>
    </header>

    <div class="container-fluid p-0">
        <div class="row g-0">
            <div class="col-lg-5 bg-light">
                <div class="editor-section m-3">
                    <h5 class="text-secondary border-bottom pb-2">Dados Pessoais</h5>
                    <div class="row g-2 mb-3">
                        <div class="col-12"><input type="text" class="form-control" id="inputName" placeholder="Nome" oninput="updateResume()"></div>
                        <div class="col-12"><input type="text" class="form-control" id="inputTarget" placeholder="Cargo Alvo" oninput="updateResume()"></div>
                        <div class="col-6"><input type="text" class="form-control" id="inputEmail" placeholder="Email" oninput="updateResume()"></div>
                        <div class="col-6"><input type="text" class="form-control" id="inputPhone" placeholder="Telefone" oninput="updateResume()"></div>
                        <div class="col-6"><input type="text" class="form-control" id="inputLinkedin" placeholder="LinkedIn" oninput="updateResume()"></div>
                        <div class="col-6"><input type="text" class="form-control" id="inputLocation" placeholder="Cidade" oninput="updateResume()"></div>
                    </div>

                    <h5 class="text-secondary border-bottom pb-2 mt-4">Resumo</h5>
                    <div class="mb-3"><textarea class="form-control" id="inputSummary" rows="5" oninput="updateResume()"></textarea></div>

                    <h5 class="text-secondary border-bottom pb-2 mt-4">Experiência</h5>
                    <div id="experience-form-container"></div>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="addExperienceField()">+ Adicionar</button>

                    <h5 class="text-secondary border-bottom pb-2 mt-4">Educação</h5>
                    <div id="education-form-container"></div>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="addEducationField()">+ Adicionar</button>

                    <h5 class="text-secondary border-bottom pb-2 mt-4">Cursos</h5>
                    <div id="courses-form-container"></div>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="addCourseField()">+ Adicionar</button>

                    <h5 class="text-secondary border-bottom pb-2 mt-4">Habilidades</h5>
                    <div id="skills-container"></div>
                    <button class="btn btn-outline-dark btn-sm w-100 mt-2" onclick="addSkillField()">+ Adicionar</button>
                </div>
            </div>

            <div class="col-lg-7 preview-container">
                <div id="resume-preview" class="theme-classic">
                    <div class="header-wrapper">
                        <div class="text-center element-align-target">
                            <div class="resume-name" id="previewName">SEU NOME</div>
                            <div class="resume-target-role" id="previewTarget">CARGO ALMEJADO</div>
                            <div class="resume-contact-container" id="previewContact"></div>
                        </div>
                    </div>
                    <div class="content-wrapper">
                        <div id="sectionSummary">
                            <div class="resume-section-title">Resumo Profissional</div>
                            <div class="resume-text" id="previewSummary"></div>
                        </div>
                        <div id="sectionExperience">
                            <div class="resume-section-title">Experiência Profissional</div>
                            <div id="previewExperienceList"></div>
                        </div>
                        <div id="sectionEducation">
                            <div class="resume-section-title">Formação Acadêmica</div>
                            <div id="previewEducationList"></div>
                        </div>
                        <div id="sectionCourses">
                            <div class="resume-section-title">Cursos e Certificações</div>
                            <div id="previewCoursesList"></div>
                        </div>
                        <div id="sectionSkills">
                            <div class="resume-section-title">Habilidades</div>
                            <div id="previewSkills" class="skills-wrapper"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            addExperienceField(); addEducationField(); addCourseField(); addSkillField(); updateResume();
        };

        // --- A MÁGICA DA IMPRESSÃO PERFEITA ---
        function printPDF() {
            // 1. Clona o conteúdo do currículo
            const resumeContent = document.getElementById('resume-preview').outerHTML;
            
            // 2. Abre uma nova janela em branco
            const printWindow = window.open('', '', 'width=900,height=900');
            
            // 3. Escreve o HTML limpo nessa janela
            printWindow.document.write(`
                <html>
                <head>
                    <title>Currículo - ${document.getElementById('inputName').value}</title>
                    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
                    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
                    <style>
                        /* CSS DE RESET PARA IMPRESSÃO */
                        @page { size: A4; margin: 0; }
                        body { margin: 0; padding: 0; background: white; font-family: 'Roboto', sans-serif; }
                        
                        /* Layout do Papel */
                        #resume-preview {
                            width: 100% !important;
                            margin: 0 !important;
                            padding: 15mm !important; /* Margem de 1.5cm */
                            box-sizing: border-box;
                        }

                        /* CSS Copiado do Principal para manter o design */
                        .resume-name { font-size: 26pt; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; text-align: center; line-height: 1.1; }
                        .resume-target-role { font-size: 14pt; font-weight: 500; text-transform: uppercase; color: #444; margin-bottom: 15px; text-align: center; }
                        .resume-contact-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 25px; border-bottom: 2px solid #000; padding-bottom: 15px; font-size: 11pt; }
                        .contact-item i { margin-right: 5px; color: #333; }
                        .resume-section-title { font-size: 14pt; font-weight: 800; text-transform: uppercase; border-bottom: 2px solid #000; margin-top: 25px; margin-bottom: 15px; padding-bottom: 4px; break-after: avoid; }
                        
                        /* QUEBRA DE PÁGINA PERFEITA */
                        .resume-item { margin-bottom: 18px; break-inside: avoid; }
                        
                        .resume-item-title { font-size: 13pt; font-weight: 700; }
                        .resume-item-subtitle { font-weight: 500; font-size: 12pt; color: #222; }
                        .resume-date { float: right; font-weight: 600; font-size: 11pt; }
                        .resume-text { font-size: 12pt; text-align: left; margin-top: 5px; white-space: pre-wrap; line-height: 1.5; color: #000; }
                        .skills-wrapper { display: flex; flex-wrap: wrap; gap: 8px 15px; }
                        .skill-tag { display: inline-block; font-weight: 700; font-size: 12pt; }
                        .skill-level { font-style: italic; font-weight: 400; font-size: 11pt; color: #444; }

                        /* Temas */
                        .theme-modern .header-wrapper {
                            background-color: #0d47a1; color: white;
                            margin: -15mm -15mm 20px -15mm; padding: 15mm 15mm 10px 15mm; text-align: left;
                            -webkit-print-color-adjust: exact; print-color-adjust: exact;
                        }
                        .theme-modern .resume-name, .theme-modern .resume-target-role, .theme-modern .contact-item, .theme-modern i { color: white !important; }
                        .theme-modern .resume-section-title { color: #0d47a1; border-bottom: 1px solid #ccc; }
                        .theme-modern .resume-date { color: #1976d2; }
                        .theme-executive { font-family: 'Merriweather', serif; }
                        .theme-executive .resume-name { border-bottom: 1px solid #333; padding-bottom: 10px; text-align: left; }
                        .theme-executive .resume-target-role { font-style: italic; text-align: left; }
                        .theme-executive .resume-contact-container { justify-content: flex-start; border: none; }
                        .theme-executive .resume-section-title { background: #eee; padding: 5px 10px; border-left: 5px solid #333; border-bottom: none; -webkit-print-color-adjust: exact; print-color-adjust: exact;}
                    </style>
                </head>
                <body>
                    ${resumeContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Aguarda carregar e imprime
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }

        // --- Resto do código (Igual ao anterior) ---
        function changeTheme() {
            const selector = document.getElementById('themeSelector');
            const preview = document.getElementById('resume-preview');
            preview.className = selector.value;
        }

        function loadExampleData() {
            if(!confirm("Preencher com dados de exemplo?")) return;
            document.getElementById('experience-form-container').innerHTML = '';
            document.getElementById('education-form-container').innerHTML = '';
            document.getElementById('courses-form-container').innerHTML = '';
            document.getElementById('skills-container').innerHTML = '';

            document.getElementById('inputName').value = "Ricardo Oliveira";
            document.getElementById('inputTarget').value = "Gerente de Projetos Sênior";
            document.getElementById('inputEmail').value = "ricardo.oliveira@email.com";
            document.getElementById('inputPhone').value = "(11) 99999-8888";
            document.getElementById('inputLinkedin').value = "linkedin.com/in/ricardooliveira";
            document.getElementById('inputLocation').value = "São Paulo, SP";
            document.getElementById('inputSummary').value = "Profissional com mais de 10 anos de experiência...";

            // Gera MUITOS dados para provar a quebra de página
            for(let i=1; i<=8; i++) {
                addExperienceField();
                let exp = document.getElementById('experience-form-container').lastElementChild;
                exp.querySelector('.title-exp').value = `Gerente de Projetos - Experiência Longa ${i}`;
                exp.querySelector('.company-exp').value = `Empresa Multinacional ${i}`;
                exp.querySelector('.start-date-exp').value = "2020-01";
                exp.querySelector('.current-role-exp').click();
                exp.querySelector('.desc-exp').value = "Descrição detalhada para ocupar espaço.\n- Responsabilidade A.\n- Responsabilidade B.\n- Responsabilidade C.\n- Conquista importante no projeto.";
            }
            updateResume();
        }

        function clearData() {
            if(confirm("Deseja limpar todos os campos?")) {
                document.querySelectorAll('input, textarea').forEach(el => el.value = '');
                document.getElementById('experience-form-container').innerHTML = '';
                document.getElementById('education-form-container').innerHTML = '';
                document.getElementById('courses-form-container').innerHTML = '';
                document.getElementById('skills-container').innerHTML = '';
                addExperienceField(); addEducationField(); addCourseField(); addSkillField();
                updateResume();
            }
        }

        function updateResume() {
            document.getElementById('previewName').innerText = document.getElementById('inputName').value || "SEU NOME";
            document.getElementById('previewTarget').innerText = document.getElementById('inputTarget').value || "CARGO ALMEJADO";
            
            const email = document.getElementById('inputEmail').value;
            const phone = document.getElementById('inputPhone').value;
            const linkedin = document.getElementById('inputLinkedin').value;
            const location = document.getElementById('inputLocation').value;
            let cHtml = "";
            if(email) cHtml += `<div class="contact-item"><i class="fas fa-envelope"></i> ${email}</div>`;
            if(phone) cHtml += `<div class="contact-item"><i class="fas fa-phone"></i> ${phone}</div>`;
            if(linkedin) {
                let clean = linkedin.replace(/^https?:\/\//,'').replace(/^www\./,'');
                cHtml += `<div class="contact-item"><i class="fab fa-linkedin"></i> ${clean}</div>`;
            }
            if(location) cHtml += `<div class="contact-item"><i class="fas fa-map-marker-alt"></i> ${location}</div>`;
            document.getElementById('previewContact').innerHTML = cHtml;
            document.getElementById('previewSummary').innerText = document.getElementById('inputSummary').value;
            updateExperience(); updateGeneric('edu'); updateGeneric('course'); updateSkills();
        }

        function updateExperience() {
            const titles = document.querySelectorAll('.title-exp');
            const companies = document.querySelectorAll('.company-exp');
            const starts = document.querySelectorAll('.start-date-exp');
            const ends = document.querySelectorAll('.end-date-exp');
            const currents = document.querySelectorAll('.current-role-exp');
            const descs = document.querySelectorAll('.desc-exp');
            let html = "";
            titles.forEach((el, i) => {
                if(el.value || companies[i].value) {
                    let dateDisplay = "";
                    if(starts[i].value) {
                        const sFmt = formatMonthYear(starts[i].value);
                        const eFmt = currents[i].checked ? "Atual" : formatMonthYear(ends[i].value);
                        const dur = calculateDuration(starts[i].value, ends[i].value, currents[i].checked);
                        dateDisplay = `${sFmt} - ${eFmt} <span style="font-weight:400; font-size:0.9em">${dur}</span>`;
                    }
                    const safeDesc = descs[i].value.replace(/</g,"&lt;").replace(/>/g,"&gt;");
                    html += `<div class="resume-item"><div class="resume-date">${dateDisplay}</div><div class="resume-item-title">${el.value}</div><div class="resume-item-subtitle">${companies[i].value}</div>${descs[i].value ? `<div class="resume-text">${safeDesc}</div>` : ''}</div>`;
                }
            });
            document.getElementById('previewExperienceList').innerHTML = html;
        }

        function updateGeneric(type) {
            let tClass = type === 'edu' ? '.title-edu' : '.title-course';
            let sClass = type === 'edu' ? '.school-edu' : '.school-course';
            let dClass = type === 'edu' ? '.date-edu' : '.date-course';
            let target = type === 'edu' ? 'previewEducationList' : 'previewCoursesList';
            const titles = document.querySelectorAll(tClass);
            const subs = document.querySelectorAll(sClass);
            const dates = document.querySelectorAll(dClass);
            let html = "";
            titles.forEach((el, i) => {
                if(el.value || subs[i].value) {
                    html += `<div class="resume-item"><div class="resume-date">${dates[i].value}</div><div class="resume-item-title">${el.value}</div><div class="resume-item-subtitle">${subs[i].value}</div></div>`;
                }
            });
            document.getElementById(target).innerHTML = html;
        }

        function updateSkills() {
            const names = document.querySelectorAll('.skill-input-name');
            const levels = document.querySelectorAll('.skill-input-level');
            let html = "";
            names.forEach((el, i) => {
                if(el.value) {
                    let lvl = levels[i].value ? ` <span class="skill-level">(${levels[i].value})</span>` : "";
                    html += `<div class="skill-tag"><span class="skill-name">• ${el.value}</span>${lvl}</div>`;
                }
            });
            document.getElementById('previewSkills').innerHTML = html;
        }

        function createField(html) {
            const d = document.createElement('div');
            d.className = "mb-3 p-3 border rounded bg-light mt-2 position-relative shadow-sm";
            d.innerHTML = `<button class="btn btn-outline-danger btn-sm position-absolute top-0 end-0 m-2" onclick="this.parentElement.remove(); updateResume()">X</button>${html}`;
            return d;
        }

        function addExperienceField() {
            document.getElementById('experience-form-container').appendChild(createField(`
                <input type="text" class="form-control mb-2 title-exp fw-bold" placeholder="Cargo" oninput="updateResume()">
                <input type="text" class="form-control mb-2 company-exp" placeholder="Empresa" oninput="updateResume()">
                <div class="row g-2 mb-2 align-items-center">
                    <div class="col-5"><label class="small text-muted">Início</label><input type="month" class="form-control form-control-sm start-date-exp" oninput="updateResume()"></div>
                    <div class="col-5"><label class="small text-muted">Fim</label><input type="month" class="form-control form-control-sm end-date-exp" oninput="updateResume()"></div>
                    <div class="col-2 text-center"><div class="form-check pt-4"><input class="form-check-input current-role-exp" type="checkbox" onchange="toggleEnd(this); updateResume()"><label class="form-check-label small" style="font-size:0.7rem">Atual</label></div></div>
                </div>
                <textarea class="form-control desc-exp" rows="4" placeholder="Descrição" oninput="updateResume()"></textarea>
            `));
        }
        function toggleEnd(chk) {
            let endIn = chk.closest('.row').querySelector('.end-date-exp');
            if(chk.checked) { endIn.value = ""; endIn.disabled = true; } else { endIn.disabled = false; }
        }
        function addEducationField() {
            document.getElementById('education-form-container').appendChild(createField(`
                <input type="text" class="form-control mb-2 title-edu fw-bold" placeholder="Curso" oninput="updateResume()">
                <input type="text" class="form-control mb-2 school-edu" placeholder="Instituição" oninput="updateResume()">
                <input type="text" class="form-control date-edu" placeholder="Ano" oninput="updateResume()">
            `));
        }
        function addCourseField() {
            document.getElementById('courses-form-container').appendChild(createField(`
                <input type="text" class="form-control mb-2 title-course fw-bold" placeholder="Nome do Curso" oninput="updateResume()">
                <input type="text" class="form-control mb-2 school-course" placeholder="Instituição" oninput="updateResume()">
                <input type="text" class="form-control date-course" placeholder="Ano/Carga" oninput="updateResume()">
            `));
        }
        function addSkillField() {
            const div = document.createElement('div'); div.className = "input-group mb-2";
            div.innerHTML = `<input type="text" class="form-control skill-input-name" placeholder="Habilidade" oninput="updateResume()"><select class="form-select skill-input-level" style="max-width:140px" onchange="updateResume()"><option value="">Nível</option><option>Básico</option><option>Intermediário</option><option>Avançado</option><option>Fluente</option></select><button class="btn btn-outline-danger" onclick="this.parentElement.remove(); updateResume()">X</button>`;
            document.getElementById('skills-container').appendChild(div);
        }
        function formatMonthYear(d) { if(!d)return""; const[y,m]=d.split('-'); return `${m}/${y}`; }
        function calculateDuration(s,e,c) { if(!s)return""; let start=new Date(s+"-01"); let end=c?new Date():(e?new Date(e+"-01"):null); if(!end)return""; start.setDate(15); if(!c)end.setDate(15); let m=(end.getFullYear()-start.getFullYear())*12; m-=start.getMonth(); m+=end.getMonth(); m++; if(m<=0)return""; const y=Math.floor(m/12); const rm=m%12; let str=" ("; if(y>0)str+=`${y} ano${y>1?'s':''}`; if(rm>0){if(y>0)str+=" e ";str+=`${rm} m${rm>1?'eses':'ês'}`;} str+=")"; return str; }
    </script>
</body>
</html>